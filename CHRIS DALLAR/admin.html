<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#020617;
    color:white;
}
header{
    background:#020617;
    padding:15px;
    text-align:center;
    border-bottom:1px solid #1e293b;
}
header h2{
    margin:0;
}
header p{
    margin:5px 0 0;
    color:#38bdf8;
    font-size:14px;
}
.container{
    padding:20px;
    max-width:900px;
    margin:auto;
}
.card{
    background:#1e293b;
    border-radius:12px;
    padding:15px;
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:15px;
    box-shadow:0 10px 20px rgba(0,0,0,0.3);
}
.card img{
    width:80px;
    height:80px;
    border-radius:50%;
    object-fit:cover;
    border:2px solid #38bdf8;
}
.info{
    flex:1;
}
.info p{
    margin:4px 0;
    font-size:14px;
}
.info b{
    color:#38bdf8;
}
.actions button{
    background:#ef4444;
    color:white;
    border:none;
    padding:8px 12px;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
}
.actions button:hover{
    background:#dc2626;
}
.empty{
    text-align:center;
    opacity:0.7;
    margin-top:40px;
}
.back{
    display:inline-block;
    margin-top:20px;
    color:#38bdf8;
    text-decoration:none;
}

/* User limit bar styles */
.limit-bar-container {
    margin-top: 15px;
    background: #334155;
    border-radius: 12px;
    overflow: hidden;
    height: 20px;
    width: 100%;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}
.limit-bar-fill {
    background: #22c55e;
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
}
.limit-bar-text {
    margin-top: 5px;
    font-size: 14px;
    text-align: center;
    color: #a5b4fc;
}
</style>
</head>

<body>

<header>
    <h2>Admin Panel – Registered Users</h2>
    <p id="totalUsers">Total Users: 0</p>
    <p id="onlineUsers">Online Users: 0</p>

    <div class="limit-bar-container" title="User Limit 40000 max">
        <div id="limitBarFill" class="limit-bar-fill"></div>
    </div>
    <div id="limitBarText" class="limit-bar-text"></div>
</header>

<div class="container" id="userList">
    <!-- Users will appear here -->
</div>

<div class="container" style="text-align:center">
    <a href="signup.html" class="back">← Back to Login</a>
</div>

<script>
/* ===============================
   CONSTANTS
================================ */
const USER_LIMIT = 40000;
const ONLINE_TIMEOUT_MS = 10 * 60 * 1000; // 10 minutes

/* ===============================
   LOAD USERS
================================ */
let users = JSON.parse(localStorage.getItem("users")) || [];
const userList = document.getElementById("userList");
const totalUsers = document.getElementById("totalUsers");
const onlineUsers = document.getElementById("onlineUsers");
const limitBarFill = document.getElementById("limitBarFill");
const limitBarText = document.getElementById("limitBarText");

/* ===============================
   ONLINE USERS CALCULATION
================================ */
// Last active data stored in localStorage key: 'userLastActive'
// Format: { email1: timestamp1, email2: timestamp2, ... }
function getOnlineUsersCount() {
    let lastActive = JSON.parse(localStorage.getItem('userLastActive')) || {};
    const now = Date.now();
    let count = 0;

    users.forEach(u => {
        if (u.email && lastActive[u.email]) {
            if (now - lastActive[u.email] <= ONLINE_TIMEOUT_MS) {
                count++;
            }
        }
    });
    return count;
}

/* ===============================
   RENDER USERS
================================ */
function renderUsers(){
    userList.innerHTML = "";

    // Update total users
    totalUsers.innerText = "Total Users: " + users.length;

    // Update online users
    onlineUsers.innerText = "Online Users: " + getOnlineUsersCount();

    // Update user limit bar
    let usedPercent = (users.length / USER_LIMIT) * 100;
    if (usedPercent > 100) usedPercent = 100;

    limitBarFill.style.width = usedPercent + "%";
    limitBarText.innerText = `${users.length} of ${USER_LIMIT} users registered`;

    if(users.length === 0){
        userList.innerHTML = `<p class="empty">No registered users found.</p>`;
        return;
    }

    users.forEach((user, index) => {
        userList.innerHTML += `
            <div class="card">
                <img src="${user.image || 'default-avatar.png'}" alt="Profile">
                <div class="info">
                    <p><b>Username:</b> ${user.username || "N/A"}</p>
                    <p><b>Email:</b> ${user.email}</p>
                    <p><b>Phone:</b> ${user.phone || "-"}</p>
                    <p><b>Country:</b> ${user.country || "-"}</p>
                </div>
                <div class="actions">
                    <button onclick="deleteUser(${index})">Delete</button>
                </div>
            </div>
        `;
    });
}

/* ===============================
   DELETE USER
================================ */
function deleteUser(index){
    if(!confirm("Are you sure you want to delete this user?")) return;

    users.splice(index, 1);
    localStorage.setItem("users", JSON.stringify(users));

    // Also remove from last active map
    let lastActive = JSON.parse(localStorage.getItem('userLastActive')) || {};
    if(users[index] && users[index].email){
        delete lastActive[users[index].email];
    }
    localStorage.setItem('userLastActive', JSON.stringify(lastActive));

    renderUsers();
}

/* ===============================
   INIT
================================ */
renderUsers();
</script>

</body>
</html>